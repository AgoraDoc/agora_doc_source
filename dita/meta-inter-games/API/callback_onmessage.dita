<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE reference PUBLIC "-//OASIS//DTD DITA Reference//EN" "reference.dtd">
<reference id="callback_onmessage">
    <title><ph keyref="onMessage"/></title>
    <shortdesc id="short"><ph id="shortdesc">游戏事件通知回调。</ph></shortdesc>
    <prolog>
        <metadata>
            <keywords>
                <indexterm keyref="onMessage"/>
            </keywords>
        </metadata>
    </prolog>
    <refbody>
        <section id="prototype">
            <p outputclass="codeblock">
            <codeblock props="android" outputclass="language-java">void onMessage(String messageId, String message);
</codeblock>
            <codeblock props="ios mac" outputclass="language-objectivec">- (void)onMessage:(NSString *)messageId message:(NSString *)message;
</codeblock>
            <codeblock props="cpp" outputclass="language-cpp"/>
            <codeblock props="electron" outputclass="language-typescript"/>
            <codeblock props="unity" outputclass="language-csharp"/>
            <codeblock props="rn" outputclass="language-typescript"/>
            <codeblock props="flutter" outputclass="language-dart"/> </p>
        </section>
        <section id="detailed_desc">
            <p>当游戏、房主、玩家、观众的状态发生变化以及游戏状态出错时，会触发该回调。</p>
        </section>
        <section id="parameters">
            <title>参数</title>
            <parml>
            <plentry>
                <pt>messageId</pt>
                <pd>事件 ID。</pd>
            </plentry>
            <plentry>
                <pt>message</pt>
                <pd>事件详情，为 JSON 字符串。  </pd>
                <pd>当游戏状态发生变化时，常见场景以及说明如下所示： <table>
                        <tgroup cols="3" align="left">
                            <colspec colname="newCol1" colnum="1" colwidth="1*"
                                align="left"/>
                            <colspec colname="c2" colnum="2" colwidth="1*"
                                align="left"/>
                            <colspec colname="c3" colnum="3" colwidth="3.35*"
                                align="left"/>
                            <thead>
                                <row>
                                    <entry>回调场景</entry>
                                    <entry valign="middle">接收者</entry>
                                    <entry valign="middle">说明</entry>
                                </row>
                            </thead>
                            <tbody>
                                <row>
                                    <entry>游戏加载完毕</entry>
                                    <entry>所有人</entry>
                                    <entry>-</entry>
                                </row>
                                <row>
                                    <entry>游戏房间信息</entry>
                                    <entry>所有人</entry>
                                    <entry>用户加入游戏时触发，返回游戏房间信息。</entry>
                                </row>
                                <row>
                                    <entry>用户加入或离开房间</entry>
                                    <entry>所有人（排除已退出的用户）</entry>
                                    <entry>用户加入或离开房间时触发。 
                                        <ul>
                                        <li><codeph>userId</codeph>：用户 ID</li>
                                        <li><codeph>isIn</codeph> ： 
                                        <ul>
                                        <li><codeph><ph keyref="true"
                                        /></codeph>：进入房间</li>
                                        <li><codeph><ph keyref="false"
                                        /></codeph>：离开房间</li>
                                        </ul></li>
                                        <li><codeph>teamId</codeph>：加入的队伍 ID</li>
                                        <li><codeph>reason</codeph>： 
                                        <ul>
                                        <li><codeph>-1</codeph>：进入房间</li>
                                        <li><codeph>0</codeph>：主动退出房间</li>
                                        <li><codeph>1</codeph>：被踢出房间</li>
                                        </ul></li>
                                        <li><codeph>kickUID</codeph>：预留参数</li>
                                        </ul></entry>
                                </row>
                                <row>
                                    <entry>用户准备或者取消准备</entry>
                                    <entry>所有人</entry>
                                    <entry>用户准备或取消准备时触发。 
                                        <ul>
                                        <li><codeph>userId</codeph>：用户 ID</li>
                                        <li><codeph>isReady</codeph> ： 
                                        <ul>
                                        <li><codeph><ph keyref="true"
                                        /></codeph>：准备</li>
                                        <li><codeph><ph keyref="false"
                                        /></codeph>：取消准备</li>
                                        </ul></li>
                                        </ul></entry>
                                </row>
                                <row>
                                    <entry>游戏开始或者结束</entry>
                                    <entry>所有人</entry>
                                    <entry>一局游戏开始或结束时触发。 
                                        <ul>
                                        <li><codeph>userId</codeph>：用户 ID</li>
                                        <li><codeph>isPlaying</codeph>
                                        <ul>
                                        <li><codeph><ph keyref="true"
                                        /></codeph>：游戏开始</li>
                                        <li><codeph><ph keyref="false"
                                        /></codeph>：游戏结束</li>
                                        </ul></li>
                                        <li><codeph>gameRoundId</codeph>：本局游戏 ID（由游戏服务商生成，在每一局游戏内唯一）</li>
                                        <li><codeph>reason</codeph>：仅在 <parmname>isPlaying</parmname> 为 <codeph><ph
                                        keyref="false"/></codeph> 时需要关注，详情如下： 
                                        <ul>
                                        <li><codeph>0</codeph>：本局游戏正常结束</li>
                                        <li><codeph>1</codeph>：玩家提前退出本局游戏</li>
                                        <li><codeph>2</codeph>：无真人玩家参与，本局游戏提前结束</li>
                                        <li><codeph>3</codeph>：所有玩家已退出，本局游戏提前结束</li>
                                        </ul></li>
                                        </ul></entry>
                                </row>
                            </tbody>
                        </tgroup>
                        </table>
                        <p>当游戏状态出错时，表示错误信息。参数说明如下所示： </p>
                        <p conkeyref="onSetOptionResult/err"/>
                    </pd>
            </plentry>
            </parml> </section>
        <example>
            <title id="hello">JSON 示例：游戏加载完毕</title>
            <codeblock outputclass="language-json">{
    "state":"game_common_hello",
    "data":{
        "msg":"hello from guess and draw"
    }
}</codeblock> </example>
        <example>
            <title id="roominfo">JSON 示例：游戏房间信息</title>
            <codeblock outputclass="language-json">{
    "state":"game_common_room_info",
    "data":{
        "gift_info":{
            "1":"生成一个高级士兵",
            "2":"生成一个英雄"
        },
        "limit_time":300
    }
} </codeblock> </example>
        <example>
            <title id="playerin">JSON 示例：用户加入或离开房间</title>
            <codeblock outputclass="language-json">{
    "state":"game_common_player_in",
    "data":{
        "userId":"123",
        "isIn":true,
        "teamId":1,
        "reason":0,
        "kickUID":1
    }
}        </codeblock> </example>
        <example>
            <title id="ready">JSON 示例：用户准备或者取消准备</title>
            <codeblock outputclass="language-json">{
    "state":"game_common_player_ready",
    "data":{
        "userId":"1001",
        "isReady":true
    }
}        </codeblock> </example>
        <example>
            <title id="playing">JSON 示例：游戏开始或者结束</title>
            <codeblock outputclass="language-json">
{
    "state":"game_common_player_playing",
    "data":{
        "userId":"123",
        "isPlaying":true,
        "gameRoundId":2,
        "reason":0
    }
}        </codeblock> </example>
        <example id="error-example">
            <title id="error">JSON 示例：错误信息</title>
            <codeblock outputclass="language-json">{
"state": "game_platform_error",
"data": {
"code": 60400,
"msg": ""
}
}</codeblock> </example>
    </refbody>
</reference>
